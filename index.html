<html>
    <head>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>

        <h1>Pixel Char Maker</h1>
        <h1 class="mobile">This website sucks hard on mobile devices, please use it from a desktop browser!<br></h1>

        <div class="group">
            <div class="row">
                <div class="col" id="folderButtons">
                    Folders:
                </div>
                <div class="row" id="folderStack"></div>
            </div>
        </div>

        <div class="row">   
            <div class="group"><div class="col">
                Layers:<br>
                <div class="row" id="layers">
                    <div id="layerButtons">
                        <button onclick="addLayer()" class="tooltip">
                            <img src="img/add.png">
                            <h6 class="tooltiptext">Add layer with selected image.</h6>
                        </button>
                        <button onclick="deleteLayer()" class="tooltip">
                            <img src="img/delete.png">
                            <h6 class="tooltiptext">Remove selected layer.</h6>
                        </button><br>
                        <button onclick="moveLayerUp()" class="tooltip">
                            <img src="img/up.png">
                            <h6 class="tooltiptext">Move selected layer up.</h6>
                        </button>
                        <button onclick="moveLayerTop()" class="tooltip">
                            <img src="img/top.png">
                            <h6 class="tooltiptext">Move selected layer to top.</h6>
                        </button><br>
                        <button onclick="moveLayerDown()" class="tooltip">
                            <img src="img/down.png">
                            <h6 class="tooltiptext">Move selected layer down.</h6>
                        </button>
                        <button onclick="moveLayerBottom()" class="tooltip">
                            <img src="img/bottom.png">
                            <h6 class="tooltiptext">Move selected layer to bottom.</h6>
                        </button><br>
                        <button onclick="replaceLayerImg()" class="tooltip">
                            <img src="img/replace.png">
                            <h6 class="tooltiptext">Replace image of selected layer with the selected image in the folder.</h6>
                        </button>
                        <button onclick="duplicateLayer()" class="tooltip">
                            <img src="img/duplicate.png">
                            <h6 class="tooltiptext">Duplicate selected layer.</h6>
                        </button><br>
                    </div>
                    <select id="layerSelector" size="8" onchange="onLayerSelect(this.value)"></select>
                </div>
                <button onclick="exportLayers(event)" class="tooltip">
                    Export layers
                    <h6 class="tooltiptext">Download a .json file with layers information.</h6>
                </button>
                <input id="importLayers" style="display:none" type="file" accept=".json, .png" multiple onchange="importLayers(event.target.files[0])">
                <button onclick="document.getElementById('importLayers').click()" class="tooltip">
                    Import layers...
                    <h6 class="tooltiptext">Select a .json file with layers information.</h6>
                </button>
            </div></div>

            <div class="group">
                Colors:<br>
                <div id="colors">
                    <div class="tooltip">
                        <select id="colorSelector"></select>
                        <h6 class="tooltiptext">Select colorable part.</h6>
                    </div>
                    <div class="tooltip">
                        <div id="palettes" class="color-grid"></div>
                        <h6 class="tooltiptext">Swap the palette for selected part.</h6>
                    </div>
                    <div class="tooltip">
                        <div id="rgb" class="rgb-grid">
                            R:<input type="range" value=100 id="redSlider" onchange="setRGB(this.value, null, null)">
                            G:<input type="range" value=100 id="greenSlider" onchange="setRGB(null, this.value, null)">
                            B:<input type="range" value=100 id="blueSlider" onchange="setRGB(null, null, this.value)">
                        </div>
                        <h6 class="tooltiptext">Multiply red, green and blue values for selected part.</h6>
                    </div>
                </div>
            </div>

            <div class="group"><div class="col">
                <div>
                    Offset:
                    <button class="tooltip" onclick="resetField('offset')">
                        Reset
                        <h6 class="tooltiptext">Move selected layer back to center.</h6>
                    </button>
                    <div class="button-grid">
                        <div class="grid-item"></div>
                        <div class="grid-item"><button class="tooltip" onclick="increaseField('offset', 0,-1)">
                            <img src="img/up.png">
                            <h6 class="tooltiptext">Move selected layer up.</h6>
                            </button></div>
                        <div class="grid-item"></div>
                        <div class="grid-item"><button class="tooltip" onclick="increaseField('offset', -1,0)">
                            <img src="img/left.png">
                            <h6 class="tooltiptext">Move selected layer left.</h6>
                            </button></div>
                        <div class="grid-item"><button class="tooltip" onclick="increaseField('offset', 0,1)">
                            <img src="img/down.png">
                            <h6 class="tooltiptext">Move selected layer down.</h6>
                            </button></div>
                        <div class="grid-item"><button class="tooltip" onclick="increaseField('offset', 1,0)">
                            <img src="img/right.png">
                            <h6 class="tooltiptext">Move selected layer right.</h6>
                            </button></div>
                    </div>
                </div>
                <br>
                <button class="tooltip" onclick="flipCells()">
                    Flip cells
                    <h6 class="tooltiptext">Flip horizontally each individual cell of the selected layer.</h6>
                </button>
                <br>
                <div>
                    Spacing:
                    <button class="tooltip" onclick="resetField('space')">
                        Reset
                        <h6 class="tooltiptext">Reset horizontal and vertical spacing of selected layer.</h6>
                    </button>
                    <div class="button-grid">
                        <div>H:</div>
                        <button class="tooltip" onclick="increaseField('space', 1,0)">
                            <img src="img/add.png">
                            <h6 class="tooltiptext">Increase horizontal spacing of selected layer.</h6>
                        </button>
                        <button class="tooltip" onclick="increaseField('space', -1,0)">
                            <img src="img/delete.png">
                            <h6 class="tooltiptext">Decrease horizontal spacing of selected layer.</h6>
                        </button>
                        <div>V:</div>
                        <button class="tooltip" onclick="increaseField('space', 0,1)">
                            <img src="img/add.png">
                            <h6 class="tooltiptext">Increase vertical spacing of selected layer.</h6>
                        </button>
                        <button class="tooltip" onclick="increaseField('space', 0,-1)">
                            <img src="img/delete.png">
                            <h6 class="tooltiptext">Decrease vertical spacing of selected layer.</h6>
                        </button>
                    </div>
                </div>
                <br>
                <div class="tooltip">
                    <input type="checkbox" id="allLayers">
                    All layers
                    <h6 class="tooltiptext">Apply offset/flip/spacing modifications to all layers.</h6>
                </div>
            </div></div>

            <div class="group" id="canvas">
                Preview:<br>
                <div class="row">
                    <div class="tooltip"> 
                        <canvas id="spritesheet" onclick="toggleCell(event)"></canvas>
                        <h6 class="tooltiptext">Click on cell to hide/show it.</h6>
                    </div>
                    <canvas id="animation"></canvas>
                </div><br>
                <div>
                    <button class="tooltip" onclick="showAllCells()">
                        Show all
                        <h6 class="tooltiptext">Show all cells of the selected layer.</h6>
                    </button>
                    <button class="tooltip" onclick="hideAllCells()">
                        Hide all
                        <h6 class="tooltiptext">Hide all cells of the selected layer.</h6>
                    </button>
                </div>
                <div>
                    <button class="tooltip" onclick="preview.refresh()">
                        Refresh
                        <h6 class="tooltiptext">Redraw preview in case some image took too long to load.</h6>
                    </button>
                    <button class="tooltip" onclick="preview.decreaseSpeed()">
                        &lt&lt
                        <h6 class="tooltiptext">Decrease animation speed.</h6>
                    </button>
                    <button class="tooltip" onclick="preview.increaseSpeed()">
                        &gt&gt
                        <h6 class="tooltiptext">Increase animation speed.</h6>
                    </button>
                </div>
            </div>
        </div>

        <div>
            <input id="templateButton" style="display:none" type="file" accept=".json, .png" multiple onchange="importTemplate(event)">
            <button onclick="document.getElementById('templateButton').click()" class="tooltip">
                Import template...
                <h6 class="tooltiptext">Select files for template (must include a 'settings.json' file).</h6>
            </button>
        </div>

        <script src="js/colormap.js"></script>
        <script src="js/paletteset.js"></script>
        <script src="js/preview.js"></script>
        <script src="js/layer.js"></script>
        <script src="js/layerlist.js"></script>
        <script src="js/buttons.js"></script>
        <script src="js/globals.js"></script>
        <script src="js/setup.js"></script>
        <script>new Setup().loadDefault('lth')</script>

        <div>
            <h2>Instructions:</h2>
            <ol>
                <li>If there are layers in the layer list but no image is showing in the preview, press the preview "Refresh" buttons.</li>
                <li>Click on a folder button to see its assets.</li>
                <li>Click on an asset image to select it (you will see a black border around the selected one).</li>
                <li>Click on the <img src="img/add.png"> button next to the layer list. 
                    This will add a new layer at the top of the list with the selected asset 
                    (sometimes it also adds a layer at the bottom, in case the assets has a "back" image).</li>
                <li>You can delete <img src="img/delete.png"> and reorder <img src="img/up.png"><img src="img/down.png"> layers freely, 
                    and also duplicate <y src="img/duplicate.png"> layers with the button next to the layer list.</li>
                <li>You can also replace <img src="img/replace.png"> the asset of a layer 
                    (note: if a layer is a "back" type, it will always load the back image, you can't change this).</li>
                <li>Choose the colorable part of the asset (the selector with Color 1, Color 2, etc). 
                    Each part has an independent color. The number of parts depends on the selected layer.</li>
                <li>Click on the color squares to select a palette. Each palette was a fixed number of tones, 
                    and the tones are swapped when you select a palette.</li>
                <li>Use the RGB sliders to adjust the color of the selected part, if needed (you can use that to make it darker).</li>
                <li>Move each layer around by changing the offset. Check the "All layers" box to affect all layers.</li>
                <li>The "Flip cells" button flips horizontally each individual cell of the selected layer. Check the "All layers" box to flip all layers.</li>
                <li>Increase the space between sprites by changing the horizontal and vertical spacing. Check the "All layers" box to affect all layers.</li>
                <li>Click on a specific cell in the preview to hide/show it. It only affects the selected layer. The "Show all" and "Hide all" buttons are there as a shortcut for this.</li>
                <li>Increase/decrease animation preview speed with the buttons next to the "Refresh" button.</li>
                <li>When done, simply save the preview image. Press the "Refresh" button before that just to make sure.</li>
            </ol>

            For IT people, see more at the <a href="https://github.com/GloamingCat/pixel-char-maker/">project's repository</a>.

            <h2>Creating Templates:</h2>
            If you want to make your own template, I recommend you to download and unzip the project's lattest version from
            the <a href=https://github.com/GloamingCat/pixel-char-maker/archive/refs/heads/main.zip>repository</a>, then copy the "templates/lth" folder 
            and start from there by modifying the "settings.json" file and adding new assets.
            <br>
            Templates for sprites are configurable with the following attributes:
            <ul>
                <li><b>rows:</b> how many rows are in the spritesheet (4 if you are using templates from RPG Maker VX or newer);</li>
                <li><b>cols:</b> how many columns are in the spritesheet (3 if you are using templates from RPG Maker VX or newer);</li>
                <li><b>width:</b> total width of the template image;</li>
                <li><b>height:</b> total height of the template image;</li>
                <li><b>paletteFile:</b> name of the PNG file with the tones for each palette (do not include '.png' in the name). 
                    The file is mandatory, but if you do not want to use the palette system, just put a single-pixel image there;</li>
                <li><b>folders:</b> list of categories for layers. For each folder we have the following attributes:
                    <ul>
                    <li><b>name:</b> name of the folder. Only used to display;</li>
                    <li><b>assets:</b> list of PNG files in this folder (do not include '.png' in the name). 
                        If it ends with '_back', then this assets has to layers, one for the front and one for the back. 
                        In this case, the back image must have the same name as the front image except for '_back' in the end 
                        (ONLY include the name of the back image in the asset list in this case).</li>
                    </ul>
                </li>
            </ul>
            Once it's done, click on the 'Import template' button and selected ALL files in the template folder, including .png and .json files. 

            <h2>Limitations:</h2>

            For templates:
            <ul>
                <li>All assets (clothes, body, etc) must have the same size;</li>
                <li>All images (assets and palettes) must be in the same folder as the settings.json file;</li>
                <li>Sprites must be equally spaced.</li>
            </ul>
            
            For palettes:
            <ul>
                <li>You can only swap palettes for a part of the layer image if these colors are included in the palette image ("palettes.png"). 
                    You can use an asset with a new color set that isn't in the palette image, but you cant swap its palette;</li>
                <li>All palettes must have the same number of tones (it is okay to repeat tones in the same palette to fill in the number, though);</li>
                <li>If an asset contains two colors (for example, a striped shirt) these two parts MUST have two different palettes in the image, 
                    otherwise they won't be interpreted as separated parts;</li>
                <li>Do not use two different palettes with a tone in common, otherwise the program won't me able to identify each palette does that tone belong to. 
                    If you need to, use almost-equal colors, but not the exact same.</li>
            </ul>
        </div>

    </body>
</html>